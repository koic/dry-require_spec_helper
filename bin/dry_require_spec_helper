#!/usr/bin/env ruby

unless File.exist?('.rspec')
  puts 'dry_require_spec_helper: .rspec: No such file or directory'

  exit 1
end

File.open('.rspec', 'a') {|file| file.write("--require spec_helper\n") }

Dir['./spec/**/*_spec.rb'].each do |path|
  source = File.read(path)

  next unless /require +('spec_helper'|"spec_helper")\n*/ === source

  source.gsub!($&, '')

  File.open(path, 'w+') {|f| f.write(source) }
end
